<div class="header bg-gradient-danger pb-8 pt-5 pt-md-8">
  <div class="container-fluid">
    <div class="header-body">
      <!-- Card stats -->
      <div class="row">
        <div class="col-xl-12 col-lg-6">
          <div class="card card-stats mb-4 mb-xl-0">
            <div class="card-body">
              <form class="form-search">
                <!-- hàng 1 -->
                <div class="row">
                  <div class="col-md-3">
                    <div class="form-group align-self-center">
                      <span>Mã Bill</span>
                      <input type="text" class="form-control" />
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="form-group align-self-center">
                      <span>Tên khách hàng</span>
                      <input type="text" class="form-control">
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="form-group align-self-center">
                      <span>Đơn giá từ</span>
                      <input type="number" class="form-control">
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="form-group align-self-center">
                      <span>Đơn giá đến</span>
                      <input type="number" class="form-control">
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-6">
                    <div class="form-group align-self-center">
                      <span>Từ ngày</span>
                      <input type="text" class="form-control" />
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group align-self-center">
                      <span>Đến ngày</span>
                      <input type="text" class="form-control" />
                    </div>
                  </div>
                </div>
                <!-- hàng 2 -->
                <div class="d-grid gap-2 d-md-flex justify-content-md-start">
                  <button type="button" class="btn btn-bidv btn-search mt-2"><i class="fa fa-search fa-btn"></i>
                    Tìm kiếm</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Page content -->
<div class="container-fluid mt--7">
  <div class="row">
    <div class="col">
      <div class="card shadow border-0">
        <div class="card-header border-0">
          <div>
            <h3 class="mb-0">Danh sách Đơn hàng</h3>
          </div>
          <div style="float: right;"><button (click)="openMyModal(myModal,Action.THEMMOI)"
              class="btn btn-sm btn-success">Thêm
              mới</button>
          </div>
        </div>
        <nz-table nzShowSizeChanger [nzData]="listOfData" [nzFrontPagination]="false" [nzLoading]="loading"
          [nzTotal]="total" [nzPageSize]="pageSize" [nzPageIndex]="pageIndex"
          (nzQueryParams)="onQueryParamsChange($event)">
          <thead>
            <tr>
              <th nzColumnKey="id" [nzSortFn]="true" style="text-align: center;">Mã Bill</th>
              <th style="text-align: center">Tên</th>
              <th nzColumnKey="total" [nzSortFn]="true" style="text-align: center">Tổng hóa đơn</th>
              <th style="text-align: center">Thanh toán</th>
              <th nzColumnKey="date" [nzSortFn]="true" style="text-align: center">Ngày bán</th>
              <!-- <th style="text-align: center">Địa chỉ</th> -->
              <!-- <th style="text-align: center">Thanh toán</th> -->
              <th style="text-align: center">Tình trạng</th>
              <th style="text-align: center">Thao tác</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let data of listOfData; ; let i = index">
              <td>{{data?.billCode}}</td>
              <td>{{data?.name}}</td>
              <td>{{data?.total| number}}</td>
              <td>{{data?.payment}}</td>
              <td>{{data?.date|date:'dd/MM/yyyy'}}</td>
              <!-- <td>{{data?.address}}</td> -->
              <!-- <td>{{data?.paymentStatus=='00'?'Đã thanh toán':'Chưa thanh toán'}}</td> -->
              <td>
                <nz-select *ngIf=" data.status != 'Cancel'; else elseBlock" ngModel="{{data.status}}"
                  (ngModelChange)="changeStatus($event,data)">
                  <nz-option nzValue="Waiting" nzLabel="Chờ xác nhận"></nz-option>
                  <!-- <nz-option nzValue="Process" nzLabel="Đang xác nhận"></nz-option> -->
                  <nz-option nzValue="Processed" nzLabel="Đã xác nhận"></nz-option>
                  <nz-option nzValue="Delivery" nzLabel="Đang giao hàng"></nz-option>
                  <nz-option nzValue="Delivered" nzLabel="Đã giao hàng"></nz-option>
                  <!-- <nz-option nzValue="Delivered" nzLabel="Đang hoàn"></nz-option>
                  <nz-option nzValue="Delivered" nzLabel="Đang hoàn"></nz-option> -->
                </nz-select>
                <ng-template #elseBlock>
                  <p class="red">Đơn hàng đã hủy</p>
                </ng-template>
              </td>
              <td>
                <button (click)="showModal(data)" class="btn btn-primary">Xem </button>
                <!-- <button (click)="openModal(data)" class="btn btn-info">Đổi hàng</button> -->
                <nz-divider nzType="vertical"></nz-divider>
                <button *ngIf=" data.status != 'Cancel'" (click)="cancelBill(data)" class="btn btn-danger" nzDanger>Hủy
                  đơn</button>
                <nz-divider nzType="vertical"></nz-divider>
              </td>
            </tr>
          </tbody>
        </nz-table>
      </div>
    </div>
  </div>
<nz-modal [nzStyle]="{ top: '20px',width:'100%' }" [(nzVisible)]="isVisible" nzTitle="Xem chi tiết">
    <ng-container *nzModalContent>
      <div class="m-container" id="print-section">
        <div class="row">
          <div class="col-md-6">
            <div>
              <h2>Mã đơn: {{this.billCode}}</h2>
            </div>
            <div>
              <h4>Khách hàng: {{this.bill?.name}}</h4>
              <!-- <h4></h2> -->
            </div>
            <div>Địa chỉ: {{this.bill?.address}}</div>
            <div>
              <label for="">Tỉnh/thành phố</label>
              <ng-select [items]="listProvince" bindLabel="ProvinceName" bindValue="ProvinceID" name="province"
                style="width: 100%;" [(ngModel)]="bill.provinceID" [disabled]="true">
              </ng-select>
            </div>
            <div>
              <label for="">Quận/Huyện</label>
              <ng-select [items]="listDistrict" bindLabel="DistrictName" bindValue="DistrictID" name="district"
                style="width: 100%;" [hideSelected]="true" [(ngModel)]="bill.districtID" [disabled]="true">
              </ng-select>
            </div>
            <div>
              <label for="">Phường/Xã</label>
              <ng-select [items]="listWard" bindLabel="WardName" bindValue="WardCode" name="ward" style="width: 100%;"
                [(ngModel)]="bill.wardCode" [disabled]="true">
              </ng-select>
            </div>
          </div>
        </div>
        <nz-divider nzPlain nzText="Chi tiết"></nz-divider>
        <nz-table nzTemplateMode>
          <thead>
            <tr>
              <th style="text-align: center;">STT</th>
              <th style="text-align: center;">Tên sản phẩm</th>
              <th style="text-align: center;">Imei</th>
              <th style="text-align: center;">Giá</th>
              <th style="text-align: center;">Số lượng</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of bill?.listBillDetail; let i = index">
              <td style="text-align: center;">{{i+1}}</td>
              <td style="text-align: center;">{{item?.productDetail?.productName}}</td>
              <td>
                <ng-select [items]="item.listImeiValue" class="custom-ng-select" bindLabel="imei" name="listImei"
                  [multiple]="true" [hideSelected]="true" [loading]="loadlstImei" [typeahead]=" textInput_imei$"
                  [disabled]="disabled" [(ngModel)]="item.listImei">
                </ng-select>
              </td>
              <td style="text-align: center;">{{item?.productDetail?.productPrice| number}}</td>
              <td style="text-align: center;">{{item?.quantity}}</td>
            </tr>
          </tbody>
        </nz-table>
        <div class="row">Giảm Giá: {{bill?.promotion?.value}} {{bill?.promotion?.type=='0'?'%':'VNĐ'}} cho đơn hàng
          {{this.billCode}}</div>
        <div style="float: right;">Tổng Tiền: {{sum|number}} VNĐ</div>
        <br>
        <div class="row" style="float: right;">Số tiền được giảm: {{discountPrice| number}} VNĐ</div>
        <hr>
        <div class="row" style="float: right;">Tổng tiền Thanh toán: {{bill?.total| number}} VNĐ</div>
      </div>
    </ng-container>
    <div *nzModalFooter>
      <button nz-button (click)="handle()" *ngIf="checkButton()">Lưu xử lý</button>
      <button nz-button nzType="default" (click)="handlePrint()"><i nz-icon nzType="printer"
          nzTheme="outline"></i>&nbsp;In hóa đơn</button>
      <button nz-button nzType="primary" (click)="handleOk()">Thoát</button>
    </div>
  </nz-modal>
  <modal #myModal>
    <modal-header>
      <h4 *ngIf="action == Action.THEMMOI">Thêm mới hóa đơn</h4>
      <h4 *ngIf="action === Action.CAPNHAT">Cập nhật hóa đơn</h4>
    </modal-header>
    <modal-content>
      <ng-stepper #cdkStepper [linear]="true">
        <cdk-step [stepControl]="stepOne.stepOneForm" [optional]="false">
          <ng-template cdkStepLabel>
            <div class="step-bullet">1</div>
            <div class="step-title">Order<span class="required">*</span></div>
          </ng-template>
          <div #stepOne class="row">
            <div class="col-1"></div>
            <div class="col-10">
              <div class="form-group">
                <label for="danhMuc">Danh mục Sản phẩm</label>
                <ng-select [items]="lstProductDetail" class="custom-ng-select" bindLabel="productName"
                  [(ngModel)]="productDetail" name="product-detail" [hideSelected]="true">
                </ng-select>
              </div>
              <button class="btn btn-primary" (click)="addProduct()" style="margin-bottom: 5px;">Thêm sản phẩm</button>
              <br />
              <div class="form-group">
                <ng-container *ngIf="listOfProductDetail.length">
                  <table class="table animated wow fadeInLeft" data-wow-delay=".5s">
                    <tr>
                      <!-- <th class="t-head">Hình ảnh</th> -->
                      <th class="t-head ">Mặt Hàng</th>
                      <th class="t-head">Giá</th>
                      <th class="t-head">Số Lượng</th>
                      <th class="t-head">Thao tác</th>
                    </tr>
                    <tr *ngFor="let item of listOfProductDetail" class="cross1">
                      <!-- <td class="t-data" style="width:  30%;">
                        <ng-image-slider #nav [images]="item?.product?.listImage" [infinite]="true" [autoSlide]="1"
                          slideImage="1" [imageSize]="{width: '100%', height: 10}"></ng-image-slider>
                      </td> -->
                      <td class="t-data" style="width:  20%;">
                        <h3>
                          {{item.productName}}
                        </h3>
                      </td>
                      <td class="t-data">
                        {{item.productPrice | number}} VNĐ
                      </td>
                      <td class="t-data">
                        <div class="quantity">
                          <div class="quantity-select">
                            <!-- <div (click)="minusProduct(item)" class="entry value-minus">&nbsp;</div> -->
                            <!-- <div class="entry value"> -->
                            <input type="text" class="form-control" [value]="item.quanlityBuy"
                              style="width: 60px;text-align: center;">
                            <!-- {{ | number}} -->
                            <!-- </div> -->
                            <!-- <div (click)="plusProduct(item)" class="entry value-plus active">&nbsp;</div> -->
                          </div>
                        </div>
                      </td>
                      <td class="t-data" style="text-align: center;">
                        <i (click)="delProduct(item.id)" class="ni ni-fat-remove text-red"></i>
                      </td>
                    </tr>
                  </table>
                  <div class="">
                    <h5 class="continue">Tổng Cộng Giỏ Hàng</h5>
                    <div class="price-details">
                      <h3>Nhập mã giảm giá</h3>
                      <div class="form-group col-6">
                        <div class="row">
                          <div class="col-4">
                            <input type="text" name="code" id="code" class="form-control" [(ngModel)]="code" trim>
                          </div>
                          <div class="col-2"><button (click)="addVorcher()" type="button" class="btn btn-primary">Áp
                              dụng</button></div>
                        </div>
                      </div>
                      <hr>
                      <!-- <span>Tổng Cộng</span> -->
                      <!-- <span class="total1">
                        Tổng giá VND
                    </span> -->
                      <!-- <span>Giảm giá</span> -->
                      <!-- <span class="total1">{{salePrice | number}} VND</span> -->
                      <!-- <span>Phí vận chuyển</span> -->
                      <!-- <span class="total1">Miễn phí</span> -->
                      <div class="clearfix"></div>
                      <div *ngIf="discountPrice!=0">Bạn được giảm {{promotion?.value}} {{promotion?.type=='0'?'%':'VNĐ'}} đơn hàng</div>
                    </div>
                    <ul class="total_price">
                      <li class="last_price">
                        <h5>Tổng tiền</h5>
                      </li>
                      <li class="last_price"><span>
                          {{sum| number}} VNĐ
                        </span></li>
                      <div class="clearfix"> </div>
                    </ul>
                    <ul class="total_price" *ngIf="discountPrice!=0">
                      <li class="last_price">
                        <h5>Giảm giá</h5>
                      </li>
                      <li class="last_price"><span>
                          {{discountPrice| number}} VNĐ
                        </span></li>
                      <div class="clearfix"> </div>
                    </ul>
                    <hr>
                    <ul class="total_price">
                      <li class="last_price">
                        <h4>Tổng tiền thanh toán</h4>
                      </li>
                      <li class="last_price"><span>
                          {{totalPrice| number}} VNĐ
                        </span></li>
                      <div class="clearfix"> </div>
                    </ul>
                    <button class="btn btn-outline-success" cdkStepperNext>Thanh Toán</button>
                  </div>
                </ng-container>
              </div>
            </div>
            <div class="col-1"></div>
            <!-- <div class="button">
              <button class="btn btn-outline-primary" cdkStepperNext>Next</button>
            </div> -->
          </div>
        </cdk-step>
        <cdk-step [stepControl]="stepTwo.stepTwoForm" [optional]="true">
          <ng-template cdkStepLabel>
            <div class="step-bullet">2</div>
            <div class="step-title">Address</div>
          </ng-template>
          <div #stepTwo class="row">
            <div class="col-1"></div>
            <div class="col-10">
              <form>
                <div class="form-group">
                  <label for="name">Tên khách hàng</label>
                  <input type="text" class="form-control" placeholder="" [(ngModel)]="newBill.name" name="name">
                </div>
                <div class="form-group">
                  <label for="phone">Số điện thoại</label>
                  <input type="text" class="form-control" placeholder="" [(ngModel)]="newBill.phone" name="phone">
                </div>
                <div class="form-group">
                  <label for="address">Địa chỉ</label>
                  <input type="text" class="form-control" placeholder="" [(ngModel)]="newBill.address" name="address">
                </div>
                <div class="form-group">
                  <label for="payment">Phương thức thanh toán</label>
                  <select name="" id="" class="form-control" [(ngModel)]="newBill.payment" name="payment">
                    <option value="Live">Trực tiếp</option>
                    <option value="Transfer">Chuyển khoản</option>
                  </select>
                </div>
              </form>
              <button (click)="payment()" class="btn btn-outline-success" style="float: right;">Thanh Toán</button>
            </div>
            <div class="col-1">
            </div>
          </div>
        </cdk-step>
        <cdk-step [stepControl]="stepThree.stepThreeForm" [optional]="true">
          <ng-template cdkStepLabel>
            <div class="step-bullet">3</div>
            <div class="step-title"></div>
          </ng-template>
          <div #stepThree></div>
        </cdk-step>
      </ng-stepper>
    </modal-content>
    <modal-footer>
      <!-- <button class="btn btn-primary" (click)="save()">Lưu</button>
    <button class="btn btn-primary" (click)="closeModal()">close</button> -->
    </modal-footer>
  </modal>
  <modal #Modal>
    <modal-header>
      <!-- <h4 *ngIf="action == Action.THEMMOI">Thêm mới Option</h4>
      <h4 *ngIf="action == Action.CAPNHAT">Cập nhật Option</h4> -->
    </modal-header>
    <modal-content>
      <div class="m-container" id="print-section">
        <div>
          <!-- <h2>Mã đơn: </h2>
          <h2>{{this.billCode}}</h2> -->
        </div>
        <nz-divider nzPlain nzText="Chi tiết"></nz-divider>
        <nz-table nzTemplateMode>
          <thead>
            <tr>
              <th style="text-align: center;">STT</th>
              <th style="text-align: center;">Tên sản phẩm</th>
              <th style="text-align: center;">Imei</th>
              <th style="text-align: center;">Số lượng</th>
              <th style="text-align: center;">Giá</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of bill?.listBillDetail; ; let i = index">
              <td style="text-align: center;">{{i+1}}</td>
              <td style="text-align: center;">{{item?.productDetail?.productName}}</td>
              <td>
                <ng-select [items]="item.listImeiValue" class="custom-ng-select" bindLabel="imei" name="listImei"
                  [multiple]="true" [hideSelected]="true" [loading]="loadlstImei" [typeahead]=" textInput_imei$"
                  [(ngModel)]="item.listImei">
                </ng-select>
              </td>
              <td style="text-align: center;">
                <input type="text" class="form-control" [(ngModel)]="item.quantity"
                  style="width: 60px;text-align: center;">
              </td>
              <td style="text-align: center;">
                {{item?.productDetail?.productPrice | number}}
              </td>
            </tr>
          </tbody>
        </nz-table>
      </div>
      <ul class="total_price">
        <li class="last_price">
          <h4>Tổng Tiền trả khách</h4>
        </li>
        <li class="last_price"><span>
            {{bill?.total| number}} VNĐ
          </span></li>
        <div class="clearfix"></div>
      </ul>
    </modal-content>
    <modal-footer>
      <!-- <button class="btn btn-primary" (click)="save()"><i class="fa fa-file" aria-hidden="true"></i> Save</button> -->
      <!-- <button class="btn btn-primary" (click)="delete()"><i class="fa fa-trash" aria-hidden="true"></i> Delete</button> -->
      <!-- <button class="btn btn-primary" (click)="closeModal()"><i class="fa fa-times" aria-hidden="true"></i>
        Close</button> -->
    </modal-footer>
  </modal>